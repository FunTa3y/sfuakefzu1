"""
–ö–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
"""
from time import time
import json
import platform
import psutil
from random import randint
from datetime import datetime
import sys

from vkbottle.bot import Blueprint, Message
from utils.edit_msg import edit_msg
from filters import ForEveryoneRule


bp = Blueprint("Ping-pong command")

quote = ['–Ø –Ω–µ –≤–æ–ª—à–µ–±–Ω–∏–∫, —è –≤—Å–µ–≥–æ –ª–∏—à—å —É—á—É—Å—å','–≠—Ç–æ –Ω–µ –±–∞–≥ ‚Äî —ç—Ç–æ –Ω–µ–∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏—á–∞.','–£–¥–∞–ª–µ–Ω–Ω—ã–π –∫–æ–¥ ‚Äî –æ—Ç–ª–∞–∂–µ–Ω–Ω—ã–π –∫–æ–¥.','–ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Ä–µ–∫—É—Ä—Å–∏—é, –Ω—É–∂–Ω–æ —Å–ø–µ—Ä–≤–∞ –ø–æ–Ω—è—Ç—å —Ä–µ–∫—É—Ä—Å–∏—é.', '–°–∞–º–∞—è —Å–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å –≤ –¥–∏–∑–∞–π–Ω–µ‚Ä¶ –¥–µ—Ä–∂–∞—Ç—å—Å—è –ø–æ–¥–∞–ª—å—à–µ –æ—Ç —Ñ–∏—á.', '–ï—Å–ª–∏ —Å—Ä–∞–∑—É –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Ö–æ—Ä–æ—à–æ, –Ω–∞–∑–æ–≤–∏—Ç–µ —ç—Ç–æ –≤–µ—Ä—Å–∏–µ–π 1.0.', 'format c: - –ª—É—á—à–∏–π –∞–Ω—Ç–∏–≤–∏—Ä—É—Å', '–ö—É–ø–ª—é–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É—Å—Ä–∞–±–æ—Ç–∞—é—â–∏–º–ø—Ä–æ–±–µ–ª–æ–º', '–ß—É–¥–µ—Å–∞ —Å–ª—É—á–∞—é—Ç—Å—è.', '–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å 1000 —Ä—É–±–ª–µ–π... –ù—É, –¥–ª—è –∫—Ä—É–≥–ª–æ–≥–æ —Å—á–µ—Ç–∞ –≤–æ–∑—å–º–µ–º 1024...', '99% –æ—à–∏–±–æ–∫ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —Å–∏–¥–∏—Ç –≤ –ø–æ–ª—É–º–µ—Ç—Ä–µ –æ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∞.', '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–±–µ–¥–∏—Ç—å —Ç–æ–≥–æ, –∫—Ç–æ –Ω–µ —Å–¥–∞–µ—Ç—Å—è', '–ú–æ—ë "–ª—é–±–ª—é" –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ–≥–æ —Å—Ç–æ–∏—Ç. –ì–æ–≤–æ—Ä—é —ç—Ç–æ —Ä–µ–¥–∫–æ –∏ –º–∞–ª–æ –∫–æ–º—É.', '–ú–∏–ª–ª–∏–æ–Ω—ã –ª—é–¥–µ–π –Ω–µ –∑–∞–º–µ–Ω—è—Ç —Ç–µ–±—è. –ù–∏–∫–æ–≥–¥–∞.', '–ù–∏—á–µ–≥–æ –≤ —ç—Ç–æ–π –∂–∏–∑–Ω–∏ –Ω–µ –¥–∞–µ—Ç—Å—è –ª–µ–≥–∫–æ']
text = quote[randint(0, (len(quote)-1))]
 
datanow = datetime.now()




@bp.on.message(ForEveryoneRule("ping"), text="<prefix>–ø–∏–Ω–≥")
async def ping_handler(message: Message):
    """
    > !–ø–∏–Ω–≥

    > üèì | –ü–æ–Ω–≥!
    > ‚è± | –û—Ç–≤–µ—Ç –∑–∞ 0.05 —Å–µ–∫—É–Ω–¥

    (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º debug)
    > üèì | –ü–æ–Ω–≥!
    > ‚è± | –û—Ç–≤–µ—Ç –∑–∞ 0.05 —Å–µ–∫—É–Ω–¥ (debug)
    > üíª | –û–°: Microsoft Windows 11
    > üîß | –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä: 21.2%
    > ‚öô | –†–∞–±–æ—Ç–∞–µ—Ç 97 —á–∞—Å–æ–≤ (4 –¥–Ω–µ–π)
    > ‚ù§ | [id322615766|VK+]
    """
    start = time()
    with open("config.json", "r", encoding="utf-8") as file:
        content = json.load(file)

    if content["debug"] is not True:
        end = time()
        result = round(end - start, 4)
        await edit_msg(
            bp.api,
            message,
            f"&#127955; | –ü–æ–Ω–≥!\n&#9201; | –û—Ç–≤–µ—Ç –∑–∞ {result} —Å–µ–∫—É–Ω–¥ (debug-Off)\n"
            f"&#128343; | –í—Ä–µ–º—è: %c\n"
            f"&#128187; | –û–°: {system} \n"
            f"&#128295; | –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä: {cpu}\n"
            f"&#9881; | –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç {work_hours} —á–∞—Å–æ–≤, —ç—Ç–æ({work_days} –¥–Ω–µ–π)\n"
            f"&#128214; | –¶–∏—Ç–∞—Ç–∞ –¥–Ω—è: random.choice–ø–∏–Ω–≥{quote}\n"
            f"&#10084; | [vk.com/public210991551|–°–æ–∑–¥–∞—Ç–µ–ª—å]\n"
            f"&#128100; | [id314119670|–ö–æ–¥–µ—Ä/–¢–µ—Ö-–ê–¥–º–∏–Ω]"
        )
    else:
        try:
            cpu = str(psutil.cpu_percent()) + "%"
        except PermissionError:
            cpu = "–Ω–µ –∏–∑–≤–µ—Å—Ç–Ω–æ (android?)"

        system_name = platform.system()

        """
        –ï—Å–ª–∏ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ –û–° Windows 11, —Ç–æ platform.release()
        –≤–µ—Ä–Ω–µ—Ç 10, —á—Ç–æ –±—ã —ç—Ç–æ–≥–æ –∏–∑–±–µ–∂–∞—Ç—å, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
        –Ω–∞ –≤–µ—Ä—Å–∏—é —Å–∏—Å—Ç–µ–º—ã:
        """
        if system_name == "Windows":
            if int(platform.version().split(".")[2]) > 20000:
                system_version = "11"
            else:
                system_version = platform.release()
        else:
            system_version = platform.release()

        system = system_name + " " + system_version
        with open("time_started.txt", "r", encoding="utf-8") as file:
            work_hours = round((round(time()) - int(file.read())) / 3600, 4)
        work_days = work_hours // 24
        end = time()
        result = round(end - start, 4)
        await edit_msg(
            bp.api, message,
            f"&#127955; | –ü–æ–Ω–≥!\n&#9201; | –û—Ç–≤–µ—Ç –∑–∞ {result} —Å–µ–∫—É–Ω–¥ (debug-Off)\n"
            f"&#128343; | –í—Ä–µ–º—è: {datanow} \n"
            f"&#128187; | –û–°: {system} \n"
            f"&#128295; | –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä: {cpu}\n"
            f"&#9881; | –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç {work_hours} —á–∞—Å–æ–≤, —ç—Ç–æ({work_days} –¥–Ω–µ–π)\n"
            f"&#128214; | –¶–∏—Ç–∞—Ç–∞ –∑–∞–ø—É—Å–∫–∞: {text}\n \n"
            f"&#10084; | [vk.com/public210991551|–°–æ–∑–¥–∞—Ç–µ–ª—å]\n"
            f"&#128100; | [id314119670|–ö–æ–¥–µ—Ä/–¢–µ—Ö-–ê–¥–º–∏–Ω]"
        )
